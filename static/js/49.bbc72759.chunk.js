(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[49,9],{602:function(e,t,i){"use strict";function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function n(e,t){return new Float64Array(e,t,16)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return r}));const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze({__proto__:null,create:r,clone:s,fromValues:function(e,t,i,r,s,n,o,a,c,l,u,b,h,d,p,j){return[e,t,i,r,s,n,o,a,c,l,u,b,h,d,p,j]},createView:n,IDENTITY:o})},613:function(e,t,i){"use strict";function r(){return[1,0,0,0,1,0,0,0,1]}function s(e,t){return new Float64Array(e,t,9)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,create:r,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,i,r,s,n,o,a,c){return[e,t,i,r,s,n,o,a,c]},createView:s})},645:function(e,t,i){"use strict";function r(){return[0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3]]}function n(e,t){return new Float64Array(e,t,4)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return n}));const o=[0,0,0,1];Object.freeze({__proto__:null,create:r,clone:s,fromValues:function(e,t,i,r){return[e,t,i,r]},createView:n,IDENTITY:o})},654:function(e,t,i){"use strict";function r(){return[0,0,0,0]}function s(e,t,i,r){return[e,t,i,r]}function n(e,t){return new Float64Array(e,t,4)}function o(){return[0,0,0,0]}function a(){return s(1,1,1,1)}function c(){return s(1,0,0,0)}function l(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function b(){return s(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return s}));const h=[0,0,0,0],d=a(),p=c(),j=l(),y=u(),m=b();Object.freeze({__proto__:null,create:r,clone:function(e){return[e[0],e[1],e[2],e[3]]},fromValues:s,fromArray:function(e){const t=[0,0,0,0],i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t},createView:n,zeros:o,ones:a,unitX:c,unitY:l,unitZ:u,unitW:b,ZEROS:h,ONES:d,UNIT_X:p,UNIT_Y:j,UNIT_Z:y,UNIT_W:m})},667:function(e,t,i){"use strict";i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return p}));var r=i(3),s=i(325),n=i(613),o=i(602),a=i(645),c=i(64),l=i(68),u=i(654);class b{constructor(e,t,i){this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(i/this.itemByteSize),this.tickHandle=s.a.before(()=>this.reset())}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=Object(r.n)(this.tickHandle)),this.itemsPtr=0,this.items=Object(r.n)(this.items),this.buffers=Object(r.n)(this.buffers)}get(){0===this.itemsPtr&&Object(s.a)(()=>{});const e=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=e;){const e=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let t=0;t<this.itemsPerBuffer;++t)this.items.push(this.itemCreate(e,t*this.itemByteSize));this.buffers.push(e)}return this.items[this.itemsPtr++]}reset(){const e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0}static createVec2f64(e=h){return new b(16,c.b,e)}static createVec3f64(e=h){return new b(24,l.d,e)}static createVec4f64(e=h){return new b(32,u.a,e)}static createMat3f64(e=h){return new b(72,n.a,e)}static createMat4f64(e=h){return new b(128,o.b,e)}static createQuatf64(e=h){return new b(32,a.d,e)}get test(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}}}const h=4096,d=(b.createVec2f64(),b.createVec3f64()),p=b.createVec4f64(),j=(b.createMat3f64(),b.createMat4f64());b.createQuatf64()},672:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o}));i(48),i(77),i(28),i(64),i(68),i(360);var r=i(654);Object(r.b)();class s{constructor(e){this.message=e}toString(){return"AssertException: "+this.message}}function n(e,t){if(!e){t=t||"assert";const e=new Error(t);throw e.stack&&console.log(e.stack),new s(t)}}function o(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}},678:function(e,t,i){"use strict";i.r(t),i.d(t,"addOrUpdateResource",(function(){return c})),i.d(t,"contentToBlob",(function(){return d})),i.d(t,"fetchResources",(function(){return a})),i.d(t,"getSiblingOfSameType",(function(){return p})),i.d(t,"getSiblingOfSameTypeI",(function(){return j})),i.d(t,"removeAllResources",(function(){return u})),i.d(t,"removeResource",(function(){return l})),i.d(t,"splitPrefixFileNameAndExtension",(function(){return h}));var r=i(45),s=i(9),n=i(3),o=i(14);async function a(e,t={},i){await e.load(i);const r=Object(o.z)(e.itemUrl,"resources"),{start:s=1,num:a=10,sortOrder:c="asc",sortField:l="created"}=t,u={query:{start:s,num:a,sortOrder:c,sortField:l,token:e.apiKey},signal:Object(n.h)(i,"signal")},b=await e.portal._request(r,u);return{total:b.total,nextStart:b.nextStart,resources:b.resources.map(({created:t,size:i,resource:r})=>({created:new Date(t),size:i,resource:e.resourceFromPath(r)}))}}async function c(e,t,i,r){if(!e.hasPath())throw new s.a(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const a=e.portalItem;await a.load(r);const c=Object(o.z)(a.userItemUrl,"add"===t?"addResources":"updateResources"),[l,u]=b(e.path),h=await d(i),p=new FormData;return l&&"."!==l&&p.append("resourcesPrefix",l),p.append("fileName",u),p.append("file",h,u),p.append("f","json"),Object(n.j)(r)&&r.access&&p.append("access",r.access),await a.portal._request(c,{method:"post",body:p,signal:Object(n.h)(r,"signal")}),e}async function l(e,t,i){if(!t.hasPath())throw new s.a("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=Object(o.z)(e.userItemUrl,"removeResources");await e.portal._request(r,{method:"post",query:{resource:t.path},signal:Object(n.h)(i,"signal")}),t.portalItem=null}async function u(e,t){await e.load(t);const i=Object(o.z)(e.userItemUrl,"removeResources");return e.portal._request(i,{method:"post",query:{deleteAll:!0},signal:Object(n.h)(t,"signal")})}function b(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function h(e){const[t,i]=function(e){const t=Object(o.n)(e);return Object(n.i)(t)?[e,""]:[e.slice(0,e.length-t.length-1),"."+t]}(e),[r,s]=b(t);return[r,s,i]}async function d(e){return e instanceof Blob?e:(await Object(r.default)(e.url,{responseType:"blob"})).data}function p(e,t){if(!e.hasPath())return null;const[i,,r]=h(e.path);return e.portalItem.resourceFromPath(Object(o.z)(i,t+r))}function j(e,t){if(!e.hasPath())return null;const[i,,r]=h(e.path);return e.portalItem.resourceFromPath(Object(o.z)(i,t+r))}},686:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(45),s=i(9),n=i(3);async function o(e,t,i,o,a,c){let l=null;if(Object(n.j)(i)){const t=e+"/nodepages/",s=t+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await Object(r.default)(s,{query:{f:"json",token:o},responseType:"json",signal:c})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:t}}catch(h){Object(n.j)(a)&&a.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",s,h),l=h}}if(!t)return null;const u=e+"/nodes/",b=u+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await Object(r.default)(b,{query:{f:"json",token:o},responseType:"json",signal:c})).data,urlPrefix:u}}catch(h){throw new s.a("sceneservice:root-node-missing","Root node missing.",{pageError:l,nodeError:h,url:b})}}},687:function(e,t,i){"use strict";function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return r}))},689:function(e,t,i){"use strict";i.d(t,"a",(function(){return A}));var r=i(0),s=i(45),n=i(9),o=(i(5),i(11)),a=i(3),c=i(13),l=i(14),u=i(1),b=(i(8),i(4),i(17)),h=i(2),d=i(15),p=i(687);function j(e){e&&e.writtenProperties&&e.writtenProperties.forEach(e=>{const t=e.target;e.newOrigin&&e.oldOrigin!==e.newOrigin&&Object(p.a)(t)&&t.updateOrigin(e.propName,e.newOrigin)})}var y=i(36),m=i(167),O=i(26),g=i(128),f=i(95),v=i(686),_=i(73),w=i(242),x=i(127),S=i(370),T=i(678);async function V(e,t,i){if(!t||!t.resources)return;const r=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(e=>e.resource.path)),o=new Set,a=[];s.forEach(t=>{r.delete(t),e.paths.push(t)});for(const n of t.resources.toUpdate)if(r.delete(n.resource.path),s.has(n.resource.path)||o.has(n.resource.path)){const{resource:t,content:r,finish:s,error:o}=n,c=Object(T.getSiblingOfSameTypeI)(t,Object(S.a)());e.paths.push(c.path),a.push(R({resource:c,content:r,finish:s,error:o},i))}else e.paths.push(n.resource.path),a.push(I(n,i)),o.add(n.resource.path);for(const n of t.resources.toAdd)a.push(R(n,i)),e.paths.push(n.resource.path);if(r.forEach(e=>{const i=t.portalItem.resourceFromPath(e);a.push(i.portalItem.removeResource(i).catch(()=>{}))}),0===a.length)return;const l=await Object(c.i)(a);Object(c.u)(i);const u=l.filter(e=>"error"in e).map(e=>e.error);if(u.length>0)throw new n.a("save:resources","Failed to save one or more resources",{errors:u})}async function R(e,t){const i=await Object(x.c)(e.resource.portalItem.addResource(e.resource,e.content,t));if(!0!==i.ok)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function I(e,t){const i=await Object(x.c)(e.resource.update(e.content,t));if(!0!==i.ok)throw e.error(i.error),i.error;e.finish(e.resource)}const P=o.a.getLogger("esri.layers.mixins.SceneService"),A=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=Object(c.h)(async(e,t,i)=>{switch(e){case 0:return this._save(t);case 1:return this._saveAs(i,t)}})}readSpatialReference(e,t){return this._readSpatialReference(t)}_readSpatialReference(e){if(null!=e.spatialReference)return O.a.fromJSON(e.spatialReference);{const t=e.store,i=t.indexCRS||t.geographicCRS,r=i&&parseInt(i.substring(i.lastIndexOf("/")+1,i.length),10);return null!=r?new O.a(r):null}}readFullExtent(e,t,i){if(null!=e&&"object"==typeof e){const r=null==e.spatialReference?{...e,spatialReference:this._readSpatialReference(t)}:e;return y.a.fromJSON(r,i)}const r=t.store,s=this._readSpatialReference(t);return null==s||null==r||null==r.extent||!Array.isArray(r.extent)||r.extent.some(e=>e<L)?null:new y.a({xmin:r.extent[0],ymin:r.extent[1],xmax:r.extent[2],ymax:r.extent[3],spatialReference:s})}readVersion(e,t){const i=t.store,r=null!=i.version?i.version.toString():"",s={major:Number.NaN,minor:Number.NaN,versionString:r},n=r.split(".");return n.length>=2&&(s.major=parseInt(n[0],10),s.minor=parseInt(n[1],10)),s}readTitlePortalItem(e){return"item-title"!==this.sublayerTitleMode?void 0:e}readTitleService(e,t){const i=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return Object(g.i)(this.url,t.name);let r=t.name;if(!r&&this.url){const e=Object(g.e)(this.url);Object(a.j)(e)&&(r=e.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&i&&(r=i+" - "+r),Object(g.a)(r)}set url(e){const t=Object(g.h)({layer:this,url:e,nonStandardUrlAllowed:!1,logger:P});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){Object(g.j)(this,e,"layers",t,r)}get parsedUrl(){const e=this._get("url");if(!e)return null;const t=Object(l.K)(e);return null!=this.layerId&&(t.path=`${t.path}/layers/${this.layerId}`),t}async _fetchIndexAndUpdateExtent(e,t){this.indexInfo=Object(v.a)(this.parsedUrl.path,this.rootNode,e,this.apiKey,P,t),null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(e){if("page"===(null==e?void 0:e.type)){var t,i;const r=e.rootIndex%e.pageSize,s=null==(t=e.rootPage)||null==(i=t.nodes)?void 0:i[r];if(null==s||null==s.obb||null==s.obb.center||null==s.obb.halfSize)throw new n.a("sceneservice:invalid-node-page","Invalid node page.");if(s.obb.center[0]<L||null==this.fullExtent||this.fullExtent.hasZ)return;const o=s.obb.halfSize,a=s.obb.center[2],c=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);this.fullExtent.zmin=a-c,this.fullExtent.zmax=a+c}else if("node"===(null==e?void 0:e.type)){var r;const t=null==(r=e.rootNode)?void 0:r.mbs;if(!Array.isArray(t)||4!==t.length||t[0]<L)return;const i=t[2],s=t[3];this.fullExtent.zmin=i-s,this.fullExtent.zmax=i+s}}async _fetchService(e){if(null==this.url)throw new n.a("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const t=await this._fetchFirstLayerId(e);null!=t&&(this.layerId=t)}return this._fetchServiceLayer(e)}async _fetchFirstLayerId(e){const t=await Object(s.default)(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id}async _fetchServiceLayer(e){const t=await Object(s.default)(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e});t.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let i=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(i=!0),i)return this._fetchVoxelServiceLayer();const r=t.data;this.read(r,{origin:"service",url:this.parsedUrl}),this.validateLayer(r)}async _fetchVoxelServiceLayer(e){const t=(await Object(s.default)(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:e})).data;this.read(t,{origin:"service",url:this.parsedUrl}),this.validateLayer(t)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&"function"==typeof this.beforeSave&&await this.beforeSave()}validateLayer(e){}_updateTypeKeywords(e,t,i){e.typeKeywords||(e.typeKeywords=[]);const r=t.getTypeKeywords();for(const s of r)e.typeKeywords.push(s);e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((e,t,i)=>i.indexOf(e)===t),1===i&&(e.typeKeywords=e.typeKeywords.filter(e=>"Hosted Service"!==e)))}async _saveAs(e,t){const i={...E,...t};let r=w.default.from(e);r||(P.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new n.a("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),r.id&&(r=r.clone(),r.id=null);const s=r.portal||_.a.getDefault();await this._ensureLoadBeforeSave(),r.type=N,r.portal=s;const o={origin:"portal-item",url:null,messages:[],portal:s,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},a={layers:[this.write({},o)]};return await Promise.all(o.resources.pendingOperations),await this._validateAgainstJSONSchema(a,o,i),r.url=this.url,r.title||(r.title=this.title),this._updateTypeKeywords(r,i,1),await s._signIn(),await s.user.addItem({item:r,folder:i&&i.folder,data:a}),await V(this.resourceReferences,o,null),this.portalItem=r,j(o),o.portalItem=r,r}async _save(e){const t={...E,...e};this.portalItem||(P.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new n.a("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==N&&(P.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+N),await Promise.reject(new n.a("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${N}"`))),await this._ensureLoadBeforeSave();const i={origin:"portal-item",url:this.portalItem.itemUrl&&Object(l.K)(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||_.a.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},r={layers:[this.write({},i)]};return await Promise.all(i.resources.pendingOperations),await this._validateAgainstJSONSchema(r,i,t),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,t,0),await this.portalItem.update({data:r}),await V(this.resourceReferences,i,null),j(i),this.portalItem}async _validateAgainstJSONSchema(e,t,r){let s=t.messages.filter(e=>"error"===e.type).map(e=>new n.a(e.name,e.message,e.details));if(r&&r.validationOptions.ignoreUnsupported&&(s=s.filter(e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name&&"scenemodification:unsupported"!==e.name)),r.validationOptions.enabled||M){const t=(await i.e(224).then(i.bind(null,1029))).validate(e,r.portalItemLayerType);if(t.length>0){const e="Layer item did not validate:\n"+t.join("\n");if(P.error("_validateAgainstJSONSchema(): "+e),"throw"===r.validationOptions.failPolicy){const e=t.map(e=>new n.a("sceneservice:schema-validation",e)).concat(s);throw new n.a("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:e})}}}if(s.length>0)throw new n.a("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})}};return Object(r.a)([Object(u.b)(f.c)],t.prototype,"id",void 0),Object(r.a)([Object(u.b)({type:O.a})],t.prototype,"spatialReference",void 0),Object(r.a)([Object(b.a)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),Object(r.a)([Object(u.b)({type:y.a})],t.prototype,"fullExtent",void 0),Object(r.a)([Object(b.a)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),Object(r.a)([Object(u.b)({readOnly:!0,type:m.a})],t.prototype,"heightModelInfo",void 0),Object(r.a)([Object(u.b)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),Object(r.a)([Object(u.b)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),Object(r.a)([Object(u.b)({readOnly:!0})],t.prototype,"version",void 0),Object(r.a)([Object(b.a)("version",["store.version"])],t.prototype,"readVersion",null),Object(r.a)([Object(u.b)({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(r.a)([Object(u.b)({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),Object(r.a)([Object(u.b)({type:String})],t.prototype,"title",void 0),Object(r.a)([Object(b.a)("portal-item","title")],t.prototype,"readTitlePortalItem",null),Object(r.a)([Object(b.a)("service","title",["name"])],t.prototype,"readTitleService",null),Object(r.a)([Object(u.b)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),Object(r.a)([Object(u.b)(f.n)],t.prototype,"url",null),Object(r.a)([Object(d.a)("url")],t.prototype,"writeUrl",null),Object(r.a)([Object(u.b)()],t.prototype,"parsedUrl",null),Object(r.a)([Object(u.b)({readOnly:!0})],t.prototype,"store",void 0),Object(r.a)([Object(u.b)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=Object(r.a)([Object(h.a)("esri.layers.mixins.SceneService")],t),t},L=-1e38,M=!1,N="Scene Service",E={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}}},704:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(3),s=i(325);class n{constructor(e){this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=s.a.before(()=>this.reset()),this.grow()}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=Object(r.n)(this.tickHandle)),this.items=Object(r.n)(this.items)}get(){return 0===this.itemsPtr&&Object(s.a)(()=>{}),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]}reset(){const e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*o);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0}grow(){for(let e=0;e<Math.max(8,Math.min(this.items.length,o));e++)this.items.push(this.allocator())}}const o=1024},714:function(e,t,i){"use strict";function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function s(e,t,i,s){for(let a=0;a<s;++a)n[0]=e[a],r(n,o,1),t[a]=o[0],i[a]=o[1]}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s}));const n=new Float64Array(1),o=new Float32Array(2)},745:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return l}));var r=i(704),s=i(38),n=i(68),o=i(667);function a(e){return e?{origin:Object(n.c)(e.origin),direction:Object(n.c)(e.direction)}:{origin:Object(n.e)(),direction:Object(n.e)()}}function c(e,t=a()){return function(e,t,i=a()){return Object(s.h)(i.origin,e),Object(s.h)(i.direction,t),i}(e.origin,e.direction,t)}function l(e,t){const i=Object(s.d)(o.b.get(),Object(s.o)(o.b.get(),e.direction),Object(s.g)(o.b.get(),t,e.origin));return Object(s.e)(i,i)}function u(e,t,i){const r=Object(s.e)(e.direction,Object(s.g)(i,t,e.origin));return Object(s.c)(i,e.origin,Object(s.b)(i,e.direction,r)),i}new r.a((function(){return{origin:null,direction:null}}))},746:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(200);class s{constructor(){this.id=Object(r.a)()}unload(){}}},793:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return j})),i.d(t,"c",(function(){return g}));i(5);var r=i(11),s=i(48),n=i(3),o=i(77),a=i(38),c=i(68),l=i(360),u=i(654),b=i(745),h=i(794),d=i(667);const p=r.a.getLogger("esri.geometry.support.sphere");function j(){return Object(u.b)()}function y(e,t=j()){return Object(l.c)(t,e)}function m(e){e[0]=e[1]=e[2]=e[3]=0}function O(e){return Array.isArray(e)?e[3]:e}function g(e){return Array.isArray(e)?e:R}function f(e,t,i){if(Object(n.i)(t))return!1;const{origin:r,direction:s}=t,o=v;o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2];const a=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],c=2*(s[0]*o[0]+s[1]*o[1]+s[2]*o[2]),l=c*c-4*a*(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]-e[3]*e[3]);if(l<0)return!1;const u=Math.sqrt(l);let b=(-c-u)/(2*a);const h=(-c+u)/(2*a);return(b<0||h<b&&h>0)&&(b=h),!(b<0)&&(i&&(i[0]=r[0]+s[0]*b,i[1]=r[1]+s[1]*b,i[2]=r[2]+s[2]*b),!0)}const v=Object(c.e)();function _(e,t,i){const r=d.b.get(),s=d.a.get();Object(a.d)(r,t.origin,t.direction);const n=O(e);Object(a.d)(i,r,t.origin),Object(a.b)(i,i,1/Object(a.m)(i)*n);const c=x(e,t.origin),l=Object(h.a)(t.origin,i);return Object(o.h)(s),Object(o.c)(s,s,l+c,r),Object(a.n)(i,i,s),i}function w(e,t,i){const r=Object(a.g)(d.b.get(),t,g(e)),s=Object(a.b)(d.b.get(),r,e[3]/Object(a.m)(r));return Object(a.c)(i,s,g(e))}function x(e,t){const i=Object(a.g)(d.b.get(),t,g(e)),r=Object(a.m)(i),n=O(e),o=n+Math.abs(n-r);return Object(s.a)(n/o)}const S=Object(c.e)();function T(e,t,i,r){const n=Object(a.g)(S,t,g(e));switch(i){case 0:{const e=Object(s.c)(n,S)[2];return Object(a.s)(r,-Math.sin(e),Math.cos(e),0)}case 1:{const e=Object(s.c)(n,S),t=e[1],i=e[2],o=Math.sin(t);return Object(a.s)(r,-o*Math.cos(i),-o*Math.sin(i),Math.cos(t))}case 2:return Object(a.o)(r,n);default:return}}function V(e,t){const i=Object(a.g)(I,t,g(e));return Object(a.m)(i)-e[3]}const R=Object(c.e)(),I=Object(c.e)();Object.freeze({__proto__:null,create:j,copy:y,fromCenterAndRadius:function(e,t){return Object(u.c)(e[0],e[1],e[2],t)},wrap:function(e){return e},clear:m,fromRadius:function(e){return e},getRadius:O,getCenter:g,fromValues:function(e,t,i,r){return Object(u.c)(e,t,i,r)},elevate:function(e,t,i){return e!==i&&Object(a.h)(i,e),i[3]=e[3]+t,i},setExtent:function(e,t,i){return p.error("sphere.setExtent is not yet supported"),e===i?i:y(e,i)},intersectRay:f,intersectsRay:function(e,t){return f(e,t,null)},intersectRayClosestSilhouette:function(e,t,i){if(f(e,t,i))return i;const r=_(e,t,d.b.get());return Object(a.c)(i,t.origin,Object(a.b)(d.b.get(),t.direction,Object(a.j)(t.origin,r)/Object(a.m)(t.direction))),i},closestPointOnSilhouette:_,closestPoint:function(e,t,i){return f(e,t,i)?i:(Object(b.a)(t,g(e),i),w(e,i,i))},projectPoint:w,distanceToSilhouette:function(e,t){const i=Object(a.g)(d.b.get(),t,g(e)),r=Object(a.p)(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))},angleToSilhouette:x,axisAt:T,altitudeAt:V,setAltitudeAt:function(e,t,i,r){const s=V(e,t),n=T(e,t,2,I),o=Object(a.b)(I,n,i-s);return Object(a.c)(r,t,o)}})},794:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o}));var r=i(48),s=i(38),n=i(68);function o(e,t){return Object(s.e)(e,t)/Object(s.m)(e)}function a(e,t){const i=Object(s.e)(e,t)/(Object(s.m)(e)*Object(s.m)(t));return-Object(r.a)(i)}Object(n.e)(),Object(n.e)()},804:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Nt}));var r=i(0),s=i(22),n=i(53),o=i(11),a=i(3),c=i(342),l=i(13),u=i(381),b=i(1),h=(i(8),i(5),i(4)),d=i(2),p=i(38),j=i(68),y=i(214),m=i(45),O=i(48),g=i(43);function f(e){return Object(g.a)("esri/libs/vxl/"+e)}var v=i(77),_=i(602),w=i(360),x=i(654),S=i(704),T=i(873),V=i(793),R=i(667);function I(e=z){return[e[0],e[1],e[2],e[3]]}function P(e,t=I()){return A(e[0],e[1],e[2],e[3],t)}function A(e,t,i,r,s=I()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}Object(j.e)(),Object(j.e)();const L=Object(j.e)();Object(j.e)(),Object(j.e)();function M(e,t,i,r){return Object(p.d)(L,t,e),function(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}(i,L,r)}function N(e,t,i){return W(e,t.origin,t.vector,0,i)}function E(e,t,i){return W(e,t.origin,t.vector,1,i)}function q(e,t){return C(e,t)>=0}function F(e,t,i){const r=Object(p.b)(R.b.get(),e,-e[3]),s=function(e,t,i){const r=Object(p.b)(R.b.get(),e,Object(p.e)(e,t));return Object(p.g)(i,t,r),i}(e,Object(p.g)(R.b.get(),t,r),R.b.get());return Object(p.c)(i,s,r),i}function C(e,t){return Object(p.e)(e,t)+e[3]}function W(e,t,i,r,s){const n=Object(p.e)(e,i);if(0===n)return!1;let o=-(Object(p.e)(e,t)+e[3])/n;return 1&r&&(o=Object(O.d)(o,0,1)),!(!(4&r)&&o<0||!(8&r)&&o>1)&&(Object(p.c)(s,t,Object(p.b)(s,i,o)),!0)}const z=[0,0,1,0],U=8;var k=i(745),B=i(794);const D=o.a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function H(e=ue){return{plane:I(e.plane),origin:Object(j.c)(e.origin),basis1:Object(j.c)(e.basis1),basis2:Object(j.c)(e.basis2)}}function K(e,t=H()){return G(e.origin,e.basis1,e.basis2,t)}function G(e,t,i,r=H()){return Object(p.h)(r.origin,e),Object(p.h)(r.basis1,t),Object(p.h)(r.basis2,i),X(r),function(e,t){Math.abs(Object(p.e)(e.basis1,e.basis2)/(Object(p.m)(e.basis1)*Object(p.m)(e.basis2)))>1e-6&&D.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(p.e)(e.basis1,ne(e)))>1e-6&&D.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(p.e)(ne(e),e.origin)-e.plane[3])>1e-6&&D.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function X(e){M(e.basis2,e.basis1,e.origin,e.plane)}function J(e,t,i){e!==i&&K(e,i);const r=Object(p.b)(R.b.get(),ne(e),t);return Object(p.c)(i.origin,i.origin,r),i.plane[3]-=t,i}function Z(e,t=H()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return Object(p.s)(t.origin,e[0]+i,e[1]+r,0),Object(p.s)(t.basis1,i,0,0),Object(p.s)(t.basis2,0,r,0),A(0,0,1,0,t.plane),t}function $(e,t,i){return!!function(e,t,i){return!!Object(a.j)(t)&&W(e,t.origin,t.direction,U,i)}(e.plane,t,i)&&oe(e,i)}function Y(e,t,i){const r=be.get();le(e,t,r,be.get());let s=Number.POSITIVE_INFINITY;for(const n of je){const o=ce(e,n,he.get()),a=R.b.get();if(N(r,o,a)){const e=Object(p.r)(R.b.get(),t.origin,a),r=Math.abs(Object(O.a)(Object(p.e)(t.direction,e)));r<s&&(s=r,Object(p.h)(i,a))}}return s===Number.POSITIVE_INFINITY?Q(e,t,i):i}function Q(e,t,i){if($(e,t,i))return i;const r=be.get(),s=be.get();le(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of je){const a=ce(e,o,he.get()),c=R.b.get();if(E(r,a,c)){const e=Object(k.d)(t,c);if(!q(s,c))continue;e<n&&(n=e,Object(p.h)(i,c))}}return ie(e,t.origin)<n&&ee(e,t.origin,i),i}function ee(e,t,i){const r=F(e.plane,t,R.b.get()),s=Object(T.d)(ae(e,e.basis1),r,-1,1,R.b.get()),n=Object(T.d)(ae(e,e.basis2),r,-1,1,R.b.get());return Object(p.g)(i,Object(p.c)(R.b.get(),s,n),e.origin),i}function te(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=Object(p.g)(R.b.get(),t,r),a=Object(B.b)(s,o),c=Object(B.b)(n,o),l=Object(B.b)(ne(e),o);return Object(p.s)(i,a,c,l)}function ie(e,t){const i=te(e,t,R.b.get()),{basis1:r,basis2:s}=e,n=Object(p.m)(r),o=Object(p.m)(s),a=Math.max(Math.abs(i[0])-n,0),c=Math.max(Math.abs(i[1])-o,0),l=i[2];return a*a+c*c+l*l}function re(e,t){return q(e.plane,t)&&oe(e,t)}function se(e,t){const i=-e.plane[3];return Object(B.b)(ne(e),t)-i}function ne(e){return e.plane}function oe(e,t){const i=Object(p.g)(R.b.get(),t,e.origin),r=Object(p.p)(e.basis1),s=Object(p.p)(e.basis2),n=Object(p.e)(e.basis1,i),o=Object(p.e)(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function ae(e,t){const i=he.get();return Object(p.h)(i.origin,e.origin),Object(p.h)(i.vector,t),i}function ce(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=Object(p.b)(R.b.get(),r,t.origin[0]),a=Object(p.b)(R.b.get(),s,t.origin[1]);Object(p.c)(i.origin,o,a),Object(p.c)(i.origin,i.origin,n);const c=Object(p.b)(R.b.get(),r,t.direction[0]),l=Object(p.b)(R.b.get(),s,t.direction[1]);return Object(p.b)(i.vector,Object(p.c)(c,c,l),2),i}function le(e,t,i,r){const s=ne(e);M(s,t.direction,t.origin,i),M(i,s,t.origin,r)}const ue={plane:I(),origin:Object(j.g)(0,0,0),basis1:Object(j.g)(1,0,0),basis2:Object(j.g)(0,1,0)},be=new S.a(I),he=new S.a(T.a),de=Object(j.e)(),pe=new S.a(()=>({origin:null,basis1:null,basis2:null,plane:null})),je=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ye=Object(_.d)(),me=Object(_.d)();Object.freeze({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=I(),this.origin=Object(j.e)(),this.basis1=Object(j.e)(),this.basis2=Object(j.e)()}},create:H,wrap:function(e,t,i){const r=pe.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=function(e,t,i,r){return A(e,t,i,r,R.c.get())}(0,0,0,0),X(r),r},copy:K,copyWithoutVerify:function(e,t){Object(p.h)(t.origin,e.origin),Object(p.h)(t.basis1,e.basis1),Object(p.h)(t.basis2,e.basis2),P(e.plane,t.plane)},fromValues:G,updateUnboundedPlane:X,elevate:J,setExtent:function(e,t,i){return Z(t,i),J(i,se(e,e.origin),i),i},fromAABoundingRect:Z,intersectRay:$,intersectRayClosestSilhouette:function(e,t,i){if($(e,t,i))return i;const r=Y(e,t,R.b.get());return Object(p.c)(i,t.origin,Object(p.b)(R.b.get(),t.direction,Object(p.j)(t.origin,r)/Object(p.m)(t.direction))),i},closestPointOnSilhouette:Y,closestPoint:Q,projectPoint:ee,projectPointLocal:te,distance2:ie,distance:function(e,t){return Math.sqrt(ie(e,t))},distanceToSilhouette:function(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of je){const s=ce(e,r,he.get()),n=Object(T.b)(s,t);n>i&&(i=n)}return Math.sqrt(i)},extrusionContainsPoint:re,axisAt:function(e,t,i,r){return function(e,t,i){switch(t){case 0:Object(p.h)(i,e.basis1),Object(p.o)(i,i);break;case 1:Object(p.h)(i,e.basis2),Object(p.o)(i,i);break;case 2:Object(p.h)(i,ne(e))}return i}(e,i,r)},altitudeAt:se,setAltitudeAt:function(e,t,i,r){const s=se(e,t),n=Object(p.b)(de,ne(e),i-s);return Object(p.c)(r,t,n),r},equals:function(e,t){return Object(p.l)(e.basis1,t.basis1)&&Object(p.l)(e.basis2,t.basis2)&&Object(p.l)(e.origin,t.origin)},transform:function(e,t,i){return e!==i&&K(e,i),Object(v.b)(ye,t),Object(v.a)(ye,ye),Object(p.n)(i.basis1,e.basis1,ye),Object(p.n)(i.basis2,e.basis2,ye),Object(p.n)(i.plane,e.plane,ye),Object(p.n)(i.origin,e.origin,t),function(e,t,i){e!==i&&P(e,i),i[3]=-Object(p.e)(i,t)}(i.plane,i.origin,i.plane),i},rotate:function(e,t,i,r){return e!==r&&K(e,r),Object(v.c)(me,Object(v.h)(me),t,i),Object(p.n)(r.basis1,e.basis1,me),Object(p.n)(r.basis2,e.basis2,me),X(r),r},normal:ne,UP:ue});var Oe=i(402),ge=i(746),fe=i(98),ve=i(200);class _e{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,s,n){this.id=Object(ve.a)(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=s,this._shaderTransformation=n,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(a.j)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(p.n)(e,e,this.getStaticTransformation()),!0)}}_e.pool=new fe.a(_e);class we{constructor(e){this.channel=e,this.id=Object(ve.a)()}}var xe=i(672),Se=i(874);class Te extends ge.a{constructor(e={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(_.d)(),this._bvObjectSpace=new Re,this._bvWorldSpace=new Re,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new Ve),this.transformation=Object(_.d)();const{geometries:t,materials:i,transformations:r,origins:s}=e;if(Array.isArray(t)){Object(xe.a)(i.length===t.length,"Object3D: materials don't match geometries"),Object(xe.a)(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=_e.pool.acquire(t[e],i[e],Object(_.c)(r[e]),{highlights:null,occludees:null,visible:this._visible},s&&s[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(v.d)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(xe.a)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,i,r,s){i=i||_.a,this._geometries.push(e);const n=_e.pool.acquire(e,t,i,{highlights:null,occludees:null,visible:this._visible},r,s);return this._geometryRecords.push(n),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(a.j)(n.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:n}),this._invalidateBoundingVolume(),n}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(a.j)(t.shaderTransformation)?this._geometryRecords.some(e=>Object(a.j)(e.shaderTransformation)):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new we(1);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(Se.a)(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(Se.c)(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new we(0);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(Se.a)(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(Se.c)(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(v.i)(Object(a.r)(t,Object(_.d)()),this.transformation,e.getStaticTransformation())}getCombinedShaderTransformation(e,t){return t=t||Object(_.d)(),Object(v.i)(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let r=0;r<this._geometryRecords.length;++r){const e=this._geometries[r],t=this._geometryRecords[r],i=e.boundingInfo;Object(a.j)(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(t)))}Object(p.f)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(p.f)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(j.e)(),t=Object(j.e)(),i=Object(Oe.b)(this.transformation);for(let r=0;r<this._geometryRecords.length;++r){const s=this._geometries[r].boundingInfo;if(Object(a.i)(s))continue;const n=this._geometryRecords[r].getShaderTransformation(),o=Object(Oe.b)(n);Object(p.n)(e,s.getCenter(),n);const c=Object(p.j)(e,this._bvObjectSpace.bounds),l=s.getBSRadius()*o;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],c+l),Object(p.n)(t,e,this.transformation);const u=Object(p.j)(t,this._bvWorldSpace.bounds),b=l*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],u+b)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),s=e.getBBMax(),n=Object(j.c)(r),o=Object(j.c)(s);Object(p.n)(n,n,i),Object(p.n)(o,o,i);for(let a=0;a<3;++a)t.min[a]=Math.min(t.min[a],n[a],o[a]),t.max[a]=Math.max(t.max[a],n[a],o[a]);for(let a=0;a<3;++a){Object(p.h)(n,r),Object(p.h)(o,s),n[a]=s[a],o[a]=r[a],Object(p.n)(n,n,i),Object(p.n)(o,o,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],n[e],o[e]),t.max[e]=Math.max(t.max[e],n[e],o[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(a.j)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(a.j)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class Ve{constructor(){this.min=Object(j.g)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(j.g)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Re extends Ve{constructor(){super(...arguments),this.bounds=Object(V.b)()}init(){Object(p.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(p.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(V.a)(this.bounds)}}class Ie{constructor(e){this.normal=Object(j.e)(),this.transformation=Object(_.d)(),this._ray=Object(k.c)(),this.init(e)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return Object(p.b)(Pe,this.ray.direction,this.dist),Object(p.m)(Pe)}getIntersectionPoint(e){return!!this.hasIntersectionPoint&&(Object(p.b)(Pe,this.ray.direction,this.dist),Object(p.c)(e,this.ray.origin,Pe),!0)}getTransformedNormal(e){return Object(p.h)(Ae,this.normal),Ae[3]=0,Object(w.l)(Ae,Ae,this.transformation),Object(p.h)(e,Ae),Object(p.o)(e,e),e}init(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?Object(k.b)(e,this._ray):this._ray=Object(k.c)()}set(e,t,i,r,s,n,o,a,c,l){e instanceof Te&&(e={type:"stage",obj:e}),this.dist=i,Object(p.h)(this.normal,r),Object(v.d)(this.transformation,s),this.target=e,this.name=t,this.drapedLayerOrder=n,this.center=o?Object(j.c)(o):null,this.geometryId=a,this.triangleNr=c,this.drapedLayerGraphicOrder=l}copyFrom(e){Object(k.b)(e.ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(j.c)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(p.h)(this.normal,e.normal),Object(v.d)(this.transformation,e.transformation)}}Object(j.e)();const Pe=Object(j.e)(),Ae=Object(x.b)(),Le=o.a.getLogger("esri.layers.VoxelWasmPerScene");class Me{constructor(e){this._halfIntTexturesAvailable=!1,this._useDepthPass=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=0,this._renderSlot=3,this._rctx=null,this._renderTargetToRestore=null,this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536],this._wasmMemBlocks=new Map,this._dbgFlags=new Set,this._dbgFlags.add(4),this._view=e,this.initialize()}get canRender(){return!!this._vxl&&"local"===this._view.viewingMode}dbg(e,t){this._dbgFlags.has(e)&&(4===e?Le.error(t):Le.warn(t))}removeRenderPlugin(){this._pluginIsActive&&this._view._stage&&(this.dbg(1,"--removeRenderPlugin--"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}initialize(){this.dbg(1,"--initialize--");for(const e of this._wasmMemBlockSizes)this._wasmMemBlocks.set(e,0);this._readyWatchHandle=Object(u.a)(()=>this._view.ready,e=>{e&&"local"===this._view.viewingMode?(this.dbg(1,"view ready status changed to ready on a local view, calling addRenderPlugin"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this.dbg(1,"view ready status changed, not ready or not a local view!"),this.removeRenderPlugin())},{initial:!0}),this._qualityWatchHandle=Object(u.a)(()=>{var e;return null==(e=this._view)?void 0:e.qualityProfile},e=>{this.dbg(3,"qualityProfile changed to "+e),this._vxl&&this._vxl.set_quality(this.toWasmQuality(e))},{initial:!0}),this._timeExtentWatchHandle=Object(u.a)(()=>{var e;return null==(e=this._view)?void 0:e.timeExtent},()=>{if(this._vxl){var e;const t=this._getTimeArgs(null==(e=this._view)?void 0:e.timeExtent);this.dbg(3,"sceneView timeExtent changed to useTime="+t.useTime+" st="+t.startTime+" et="+t.endTime),this._vxl.set_scene_time_extent(t.startTime,t.endTime,t.useTime),this._renderPluginContext.requestRender()}},{initial:!0})}initializeRenderContext(e){this.dbg(1,"--initializeRenderContext--");const t=e.renderContext.rctx;"webgl2"===t.webglVersion?(this._renderPluginContext=e,this._rctx=e.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this.initializeWasm(t.gl)):this.dbg(4,"WebGL 1 context only!")}uninitializeRenderContext(){this._renderPluginContext=null,this._rctx=null,this.dbg(1,"--uninitializeRenderContext--")}restoreFramebuffer(){if(!this._renderTargetToRestore)return;const e=this._renderTargetToRestore.fbo;if(!this._rctx)return void this.dbg(4,"no context in restoreFramebuffer!");this._rctx.bindFramebuffer(e,!0);const t=this._renderTargetToRestore.viewport;this._rctx.setViewport(t.x,t.y,t.width,t.height)}bindPreviousDepthToSlot(e,t){const i=!!this._rctx,r=!!this._renderTargetToRestore;if(!i||!r)return 0;const s=this._renderTargetToRestore.fbo.depthStencilTexture;return s?(0===t?this._rctx.bindTexture(null,e,!0):this._rctx.bindTexture(s,e,!0),1):(this.dbg(4,"no depth/stencil texture exists!"),0)}setBlendState(e,t,i,r){this._rctx?(this._rctx.setBlendingEnabled(1===e),this._rctx.setBlendFunction(t,i),this._rctx.setBlendEquation(r)):this.dbg(4,"setBlendState callback has no rendering context!")}setFrontFace(e){this._rctx?this._rctx.setFrontFace(e):this.dbg(4,"setFrontFace callback has no rendering context!")}setDepthStencilStateFunction(e,t,i){this._rctx?(this._rctx.setDepthFunction(i),this._rctx.setDepthTestEnabled(1===e),this._rctx.setDepthWriteEnabled(1===t),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(519,0,255),this._rctx.setStencilOpSeparate(1028,7680,7682,7680),this._rctx.setStencilOpSeparate(1029,7680,7683,7680)):this.dbg(4,"setDepthStencilStateFunction callback has no rendering context!")}setRasterizerState(e){if(this._rctx)switch(e){case 1:this._rctx.setFaceCullingEnabled(!1);break;case 3:this._rctx.setCullFace(1029),this._rctx.setFaceCullingEnabled(!0);break;case 2:this._rctx.setCullFace(1028),this._rctx.setFaceCullingEnabled(!0)}else this.dbg(4,"setRasterizerState callback has no rendering context!")}setViewport(e,t,i,r){this._rctx?this._rctx.setViewport(e,t,i,r):this.dbg(4,"setViewport callback has no rendering context!")}_syncRequestsResponses(){this._layers.forEach((e,t)=>{const i=[];e.responses.forEach((e,r)=>{i.push(r),this.dbg(2,"responding for requestID:"+r+" size:"+e.size),this._vxl.respond(t,r,e)});const r=e.responses;for(const o of i)r.delete(o);const s=this._vxl.get_new_requests(t),n=e.abortController.signal;for(const o in s){e.outstandingRequestCount+=1,1===e.outstandingRequestCount&&e.layerView.updatingFlagChanged();const t=s[o],i={responseType:"array-buffer",signal:n};this.dbg(2,"making requestID:"+o+" url:"+t.url),Object(m.default)(t.url,i).then(i=>{e.outstandingRequestCount-=1,0===e.outstandingRequestCount&&e.layerView.updatingFlagChanged(),this.dbg(2,"have response for requestID:"+o);let s=0;if(i.data.byteLength>0){s=this._vxl._malloc(i.data.byteLength);const e=new Uint8Array(this._vxl.HEAPU8.buffer,s,i.data.byteLength),t=new Uint8Array(i.data);for(let r=0;r<i.data.byteLength;++r)e[r]=t[r]}r.set(+o,{type:t.type,ptr:s,size:i.data.byteLength,success:!0})}).catch(i=>{e.outstandingRequestCount-=1,0===e.outstandingRequestCount&&e.layerView.updatingFlagChanged(),Object(l.l)(i)||(this.dbg(4,`requestID:${o} failed, error=${i.toString()}`),r.set(+o,{type:t.type,ptr:0,size:0,success:!1}))})}})}updateWasmCamera(e){this._vxl.set_projection_matrix.apply(this._vxl,e.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,e.viewMatrix),this._vxl.set_near_far(e.near,e.far)}isUpdating(e){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(e)&&this._layers.get(e).outstandingRequestCount>0}setEnabled(e,t){this._layers.forEach((i,r)=>{i.layerView===e&&(this._vxl.set_enabled(r,t),this._renderPluginContext.requestRender())})}setSlices(e,t){const i={mask:2,slices:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,i,!0)}setDynamicSections(e,t){const i={mask:4,dynamicSections:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,i,!0)}setStaticSections(e,t){const i={mask:1,staticSections:t};return this._doMaskedUIUpdate(e,i,!0)}setCurrentVariable(e,t){const i={mask:1024,currentVariable:t};return this._doMaskedUIUpdate(e,i,!0)}setRenderMode(e,t){const i={mask:8192,renderMode:t};return this._doMaskedUIUpdate(e,i,!0)}_doMaskedUIUpdate(e,t,i){if(!this._vxl)return!1;let r=!1;return this._layers.forEach((i,s)=>{if(i.layerView===e){const e={str:JSON.stringify(t),byteCount:0,ptr:0,isReusable:!1};this._AllocateBlock(e)&&(r=1===this._vxl.handle_masked_ui_update(s,e.ptr,e.byteCount),e.isReusable||this._vxl._free(e.ptr))}}),r&&i&&this._renderPluginContext.requestRender(),r}addVoxelLayer(e){if(!this._vxl){const t={layerView:e,resolveCallback:null,rejectCallback:null},i=new Promise((e,i)=>{t.resolveCallback=e,t.rejectCallback=i});return this._newLayers.push(t),i}const t=this._addVoxelLayer(e);return t<0?Promise.reject(-1):Promise.resolve(t)}removeVoxelLayer(e){if(!this._vxl){const t=this._newLayers.findIndex(t=>e===t.layerView);t>=0&&(this._newLayers[t].resolveCallback(-1),this._newLayers.splice(t,1));const i=this._newLayers.length;return 0===i&&(this.dbg(1," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),i}let t=-1;this._layers.forEach((i,r)=>{i.layerView===e&&(t=r,i.abortController.abort(),this._vxl.remove_layer(t))}),t>=0&&this._layers.delete(t);const i=this._layers.size;return 0===i&&(this.dbg(1," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),i}_getBlockSize(e){for(const t of this._wasmMemBlockSizes)if(e<t)return t;return-1}_AllocateBlock(e){e.byteCount=this._vxl.lengthBytesUTF8(e.str)+1;const t=this._getBlockSize(e.byteCount);return t<0?(e.isReusable=!1,e.ptr=this._vxl._malloc(e.byteCount)):(e.isReusable=!0,e.ptr=this._wasmMemBlocks.get(t),0===e.ptr&&(e.ptr=this._vxl._malloc(t),this._wasmMemBlocks.set(t,e.ptr))),0!==e.ptr&&(this._vxl.stringToUTF8(e.str,e.ptr,e.byteCount),!0)}_getTimeArgs(e){let t=-Number.MAX_VALUE,i=Number.MAX_VALUE,r=!1;return Object(a.j)(e)&&(e.isAllTime?r=!0:(Object(a.j)(e.start)&&(r=!0,t=e.start.getTime()/1e3),Object(a.j)(e.end)&&(r=!0,i=e.end.getTime()/1e3))),{startTime:t,endTime:i,useTime:r}}_addVoxelLayer(e){var t;const i=e.layer;let r=-1;const s=i.getConfiguration();if(s.length<1)return-1;const n={str:s,byteCount:0,ptr:0,isReusable:!1};if(!this._AllocateBlock(n))return-1;const o=this._getTimeArgs(null==(t=this._view)?void 0:t.timeExtent),a=this._view.spatialReference.isWGS84&&i.spatialReference.isWGS84?111319.49079327357:1;if(r=this._vxl.add_layer(i.serviceRoot,n.ptr,n.byteCount,a,a,o.startTime,o.endTime,o.useTime),n.isReusable||this._vxl._free(n.ptr),r>=0){const t=new AbortController;if(this._layers.set(r,{layerView:e,responses:new Map,outstandingRequestCount:0,abortController:t}),!this._halfIntTexturesAvailable){const t=[];let i="";for(const r of e.layer.variables)"Int16"!==r.renderingFormat.type&&"UInt16"!==r.renderingFormat.type||(t.push(r.name),r.id===e.layer.style.currentVariableId&&(i=r.name));""!==i&&Le.error(`The voxel layer '${e.layer.title}' cannot render the variable '${i}' in the current browser`),t.length>0&&Le.warn(`The voxel layer '${e.layer.title}' cannot render the variables '${t.toString()}' in the current browser`)}return r}return-1}prepareRender(e){if(!this._vxl)return;const t=e.viewForward,i=e.eye;this._vxl.update_camera_pos_and_direction(i[0],i[1],i[2],t[0],t[1],t[2]);const r=this._vxl.cull();this.dbg(2,"missingResourceCount="+r),this._moreToLoad=r>0,this._havePreparedWithAllLayers=0===this._newLayers.length}render(e){if(!this._vxl)return!1;for(const i of this._newLayers){const e=this._addVoxelLayer(i.layerView);-1===e?i.rejectCallback(-1):i.resolveCallback(e)}if(this._newLayers=[],e.pass!==this._renderPass)return!1;if(e.slot!==this._renderSlot)return!1;if(0===this._layers.size)return this.dbg(4,"No voxel layers but RenderPlugin instance is being asked to render!"),!0;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this._syncRequestsResponses(),this._vxl.begin_frame();const t=this._renderTargetToRestore.viewport;return t.width===this._viewportWidth&&t.height===this._viewportHeight||(this._viewportWidth=t.width,this._viewportHeight=t.height,this._vxl.set_viewport(t.width,t.height)),0===t.x&&0===t.y||this.dbg(4,"Unsupported viewport parameters detected!"),this.updateWasmCamera(e.camera),this._vxl.draw(),this._renderTargetToRestore.fbo=null,e.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),e.rctx.externalVertexArrayObjectUpdate(),e.rctx.externalVertexBufferUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender(),!0}queryDepthRange(e){this.dbg(1,"--queryDepthRange--");const t=e.viewForward,i=e.eye;this._vxl.update_camera_pos_and_direction(i[0],i[1],i[2],t[0],t[1],t[2]),this._vxl.cull();const r={near:5,far:1e4};return r.near=this._vxl.get_near(),r.far=this._vxl.get_far(),r}destroy(){this.dbg(1,"--destroy--"),this.removeRenderPlugin(),this._readyWatchHandle=Object(a.p)(this._readyWatchHandle),this._qualityWatchHandle=Object(a.p)(this._qualityWatchHandle),this._timeExtentWatchHandle=Object(a.p)(this._timeExtentWatchHandle),this._vxl&&(this._layers.forEach(e=>{e.abortController.abort()}),this._wasmMemBlocks.forEach(e=>{0!==e&&this._vxl._free(e)}),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}initializeWasm(e){return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=function(e){return new Promise(t=>i.e(207).then(i.bind(null,1017)).then(e=>e.v).then(({default:i})=>{const r=i({locateFile:f,preinitializedWebGLContext:e,onRuntimeInitialized:()=>t(r)})})).catch(e=>Promise.reject(e))}(e).then(e=>{var t;if(this._vxl=e,this._vxlPromise=null,this._newLayers.length<=0)return this.dbg(1," no voxel layers left after WASM downloaded, removing RenderPlugin and destroying"),void this.destroy();const i=this._getTimeArgs(null==(t=this._view)?void 0:t.timeExtent),r=this._vxl.addFunction(this.restoreFramebuffer.bind(this),"v"),s=this._vxl.addFunction(this.setBlendState.bind(this),"viiii"),n=this._vxl.addFunction(this.setFrontFace.bind(this),"vi"),o=this._vxl.addFunction(this.setRasterizerState.bind(this),"vi"),a=this._vxl.addFunction(this.setDepthStencilStateFunction.bind(this),"viii"),c=this._vxl.addFunction(this.setViewport.bind(this),"viiii"),l=this._vxl.addFunction(this.bindPreviousDepthToSlot.bind(this),"iii");this._vxl.initialize_voxel_wasm(r,s,n,o,a,c,l,i.startTime,i.endTime,i.useTime),this._vxl.set_quality(this.toWasmQuality(this._view.qualityProfile)),this._renderPluginContext&&this._renderPluginContext.requestRender()}).catch(()=>{for(const e of this._newLayers)e.rejectCallback(-2);this.dbg(4," WASM failed to download, removing RenderPlugin and destroying"),this.destroy()})),this._vxlPromise)}get type(){return"external"}get isGround(){return!1}get slicePlane(){return!1}get intersectionHandlerId(){return"unj"}intersect(e,t,i,r,s){if(!this._vxl)return;if(!this._rctx)return;if(0===this._layers.size)return;if(s[0]<0||s[0]>e.camera.viewport[2]||s[1]<0||s[1]>e.camera.viewport[3])return;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};const n=e.camera.viewForward,o=e.camera.eye;this._vxl.update_camera_pos_and_direction(o[0],o[1],o[2],n[0],n[1],n[2]),this.updateWasmCamera(e.camera),this._vxl.begin_frame(),this._useDepthPass?this.intersectDepth(e,t,i,r,s):this.intersectObject(e,t,i,r,s),this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate()}intersectObject(e,t,i,r,s){const n=this._vxl.pick_object(s[0],s[1]);if(n.success){const s=Object(j.e)();Object(p.w)(s,r,i),Object(p.o)(s,s);const o=Object(p.j)(i,r),a=Object(j.e)();Object(p.s)(a,n.worldX,n.worldY,n.worldZ);const c=Object(j.e)();Object(p.w)(c,a,i);const l=Object(j.e)();Object(p.b)(l,s,Object(p.e)(c,s));const u=Object(j.e)();Object(p.c)(u,i,l);const b=Object(p.j)(i,u),h=Object(O.d)(b/o,0,1),d=e=>{e.intersector="Voxel",e.dist=h,e.target={type:"external",metadata:{layerUid:this.intersectionHandlerId}}},y=e.results.min;(null==y.dist||h<y.dist)&&(null==t||t(i,r,h))&&d(y);const m=e.results.max;if(0!==e.options.store&&(null==m.dist||h>m.dist)&&(null==t||t(i,r,h))&&d(m),2===e.options.store){const t=new Ie(e.ray);d(t),e.results.all.push(t)}}}intersectDepth(e,t,i,r,s){const n=this._vxl.pick_depth(s[0],s[1]);if(n.success){const s=Object(j.e)();Object(p.w)(s,r,i),Object(p.o)(s,s);const o=Object(p.j)(i,r),a=Object(j.e)();Object(p.s)(a,n.worldX,n.worldY,n.worldZ);const c=Object(j.e)();Object(p.w)(c,a,i);const l=Object(j.e)();Object(p.b)(l,s,Object(p.e)(c,s));const u=Object(j.e)();Object(p.c)(u,i,l);const b=Object(p.j)(i,u),h=Object(O.d)(b/o,0,1),d=e=>{e.intersector="Voxel",e.dist=h,e.target={type:"external",metadata:{layerUid:this.intersectionHandlerId}}},y=e.results.min;(null==y.dist||h<y.dist)&&(null==t||t(i,r,h))&&d(y);const m=e.results.max;if(0!==e.options.store&&(null==m.dist||h>m.dist)&&(null==t||t(i,r,h))&&d(m),2===e.options.store){const t=new Ie(e.ray);d(t),e.results.all.push(t)}}}toWasmQuality(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2}}}class Ne{constructor(){this.view2WASM=new Map}static getInstance(){return Ne.instance||(Ne.instance=new Ne),Ne.instance}isUpdating(e,t){return!!this.view2WASM.has(e)&&this.view2WASM.get(e).isUpdating(t)}addLayer(e,t){return this.view2WASM.has(e)||this.view2WASM.set(e,new Me(e)),this.view2WASM.get(e).addVoxelLayer(t)}removeLayer(e,t){this.view2WASM.has(e)&&this.view2WASM.get(e).removeVoxelLayer(t)<1&&this.view2WASM.delete(e)}setLayerEnabled(e,t,i){this.view2WASM.has(e)&&this.view2WASM.get(e).setEnabled(t,i)}setLayerSlices(e,t){let i=!1;return this.view2WASM.forEach((r,s)=>{s.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(s=>{s.layer===e&&(i=r.setSlices(s,t))})}),i}setLayerDynamicSections(e,t){let i=!1;return this.view2WASM.forEach((r,s)=>{s.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(s=>{s.layer===e&&(i=r.setDynamicSections(s,t))})}),i}setLayerCurrentVariable(e,t){let i=!1;return this.view2WASM.forEach((r,s)=>{s.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(s=>{s.layer===e&&(i=r.setCurrentVariable(s,t))})}),i}setLayerRenderMode(e,t){let i=!1;return this.view2WASM.forEach((r,s)=>{s.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(s=>{s.layer===e&&(i=r.setRenderMode(s,t))})}),i}setLayerStaticSections(e,t){let i=!1;return this.view2WASM.forEach((r,s)=>{s.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(s=>{s.layer===e&&(i=r.setStaticSections(s,t))})}),i}}var Ee=i(363),qe=i(356),Fe=i(345),Ce=i(344),We=i(346),ze=i(689),Ue=i(95),ke=i(10);let Be=class extends ke.a{constructor(){super(...arguments),this.enabled=!0,this.label="",this.normal=null,this.point=null}};Object(r.a)([Object(b.b)({type:Boolean,json:{default:!0,write:!0}})],Be.prototype,"enabled",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],Be.prototype,"label",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:!0}})],Be.prototype,"normal",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:!0}})],Be.prototype,"point",void 0),Be=Object(r.a)([Object(d.a)("esri.layers.support.VoxelDynamicSection")],Be);const De=Be;let He=class extends ke.a{constructor(){super(...arguments),this.enabled=!0,this.label="",this.normal=null,this.point=null}};Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],He.prototype,"enabled",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],He.prototype,"label",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:!0}})],He.prototype,"normal",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:!0}})],He.prototype,"point",void 0),He=Object(r.a)([Object(d.a)("esri.layers.support.VoxelSlice")],He);const Ke=He;let Ge=class extends ke.a{constructor(){super(...arguments),this.enabled=!0,this.href=null,this.id=null,this.label="",this.normal=null,this.point=null,this.sizeInPixel=null,this.slices=null,this.timeId=0,this.variableId=null}};Object(r.a)([Object(b.b)({type:Boolean,json:{default:!0,write:!0}})],Ge.prototype,"enabled",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],Ge.prototype,"href",void 0),Object(r.a)([Object(b.b)({type:h.a,json:{write:{enabled:!0,isRequired:!0}}})],Ge.prototype,"id",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],Ge.prototype,"label",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],Ge.prototype,"normal",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],Ge.prototype,"point",void 0),Object(r.a)([Object(b.b)({type:[h.a],json:{write:{enabled:!0,isRequired:!0}}})],Ge.prototype,"sizeInPixel",void 0),Object(r.a)([Object(b.b)({type:[Ke],json:{write:!0}})],Ge.prototype,"slices",void 0),Object(r.a)([Object(b.b)({type:h.a,json:{default:0,write:!0}})],Ge.prototype,"timeId",void 0),Object(r.a)([Object(b.b)({type:h.a,json:{write:{enabled:!0,isRequired:!0}}})],Ge.prototype,"variableId",void 0),Ge=Object(r.a)([Object(d.a)("esri.layers.support.VoxelSection")],Ge);const Xe=Ge;var Je=i(101);let Ze=class extends ke.a{constructor(){super(...arguments),this.diffuseFactor=.5,this.specularFactor=.5}};Object(r.a)([Object(b.b)({type:Number,range:{min:0,max:1},json:{default:.5,write:!0}})],Ze.prototype,"diffuseFactor",void 0),Object(r.a)([Object(b.b)({type:Number,range:{min:0,max:1},json:{default:.5,write:!0}})],Ze.prototype,"specularFactor",void 0),Ze=Object(r.a)([Object(d.a)("esri.layers.support.VoxelSimpleShading")],Ze);const $e=Ze;var Ye=i(24);let Qe=class extends ke.a{constructor(){super(...arguments),this.color=null,this.value=null,this.enabled=!0,this.label=null}};Object(r.a)([Object(b.b)({type:Ye.a,json:{type:[h.a],write:{enabled:!0,isRequired:!0}}})],Qe.prototype,"color",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],Qe.prototype,"value",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{default:!0,write:!0}})],Qe.prototype,"enabled",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],Qe.prototype,"label",void 0),Qe=Object(r.a)([Object(d.a)("esri.layers.support.VoxelIsosurface")],Qe);const et=Qe;let tt=class extends ke.a{constructor(){super(...arguments),this.alpha=0,this.position=0}};Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],tt.prototype,"alpha",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],tt.prototype,"position",void 0),tt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelAlphaStop")],tt);const it=tt;let rt=class extends ke.a{constructor(){super(...arguments),this.color=null,this.position=0}};Object(r.a)([Object(b.b)({type:Ye.a,json:{type:[h.a],write:{enabled:!0,isRequired:!0}}})],rt.prototype,"color",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],rt.prototype,"position",void 0),rt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelColorStop")],rt);const st=rt;let nt=class extends ke.a{constructor(){super(...arguments),this.enabled=!1,this.range=null}};Object(r.a)([Object(b.b)({type:Boolean,json:{default:!1,write:!0}})],nt.prototype,"enabled",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:!0}})],nt.prototype,"range",void 0),nt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelRangeFilter")],nt);const ot=nt;let at=class extends ke.a{constructor(e){super(e),this.interpolation=null,this.stretchRange=null,this.rangeFilter=null,this.colorStops=new s.a,this.alphaStops=new s.a}set colorStops(e){this._set("colorStops",Object(Je.b)(e,this._get("colorStops"),s.a.ofType(st)))}set alphaStops(e){this._set("alphaStops",Object(Je.b)(e,this._get("alphaStops"),s.a.ofType(it)))}};Object(r.a)([Object(b.b)({type:["linear","nearest"],json:{write:!0}})],at.prototype,"interpolation",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],at.prototype,"stretchRange",void 0),Object(r.a)([Object(b.b)({type:s.a.ofType(st),json:{write:{enabled:!0,overridePolicy(){return{enabled:!!this.colorStops&&this.colorStops.length>0}}}}})],at.prototype,"colorStops",null),Object(r.a)([Object(b.b)({type:s.a.ofType(it),json:{write:{enabled:!0,overridePolicy(){return{enabled:!!this.alphaStops&&this.alphaStops.length>0}}}}})],at.prototype,"alphaStops",null),Object(r.a)([Object(b.b)({type:ot,json:{write:!0}})],at.prototype,"rangeFilter",void 0),at=Object(r.a)([Object(d.a)("esri.layers.support.VoxelTransferFunctionStyle")],at);const ct=at;let lt=class extends ke.a{constructor(){super(...arguments),this.color=null,this.value=0,this.enabled=!0,this.label=null}};Object(r.a)([Object(b.b)({type:Ye.a,json:{type:[h.a],write:{enabled:!0,isRequired:!0}}})],lt.prototype,"color",void 0),Object(r.a)([Object(b.b)({type:h.a,json:{write:{enabled:!0,isRequired:!0}}})],lt.prototype,"value",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{default:!0,write:!0}})],lt.prototype,"enabled",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],lt.prototype,"label",void 0),lt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelUniqueValue")],lt);const ut=lt;let bt=class extends ke.a{constructor(e){super(e),this.variableId=0,this.label=null,this.transferFunction=null,this.uniqueValues=new s.a,this.isosurfaces=new s.a}set uniqueValues(e){this._set("uniqueValues",Object(Je.b)(e,this._get("uniqueValues"),s.a.ofType(ut)))}set isosurfaces(e){this._set("isosurfaces",Object(Je.b)(e,this._get("isosurfaces"),s.a.ofType(et)))}};Object(r.a)([Object(b.b)({type:h.a,json:{write:{enabled:!0,isRequired:!0}}})],bt.prototype,"variableId",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],bt.prototype,"label",void 0),Object(r.a)([Object(b.b)({type:ct,json:{write:{enabled:!0,overridePolicy(){return{enabled:!this.uniqueValues||this.uniqueValues.length<1}}}}})],bt.prototype,"transferFunction",void 0),Object(r.a)([Object(b.b)({type:s.a.ofType(ut),json:{write:{enabled:!0,overridePolicy(){return{enabled:!!this.uniqueValues&&this.uniqueValues.length>0}}}}})],bt.prototype,"uniqueValues",null),Object(r.a)([Object(b.b)({type:s.a.ofType(et),json:{write:{enabled:!0,overridePolicy(){const e=!this.uniqueValues||this.uniqueValues.length<1,t=!!this.isosurfaces&&this.isosurfaces.length>0;return{enabled:e&&t}}}}})],bt.prototype,"isosurfaces",null),bt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelVariableStyle")],bt);const ht=bt;let dt=class extends ke.a{constructor(e){super(e),this.volumeId=0,this.verticalExaggeration=1,this.exaggerationMode="scale-height",this.verticalOffset=0,this.slices=new s.a,this.dynamicSections=new s.a}set slices(e){this._set("slices",Object(Je.b)(e,this._get("slices"),s.a.ofType(Ke)))}set dynamicSections(e){this._set("dynamicSections",Object(Je.b)(e,this._get("dynamicSections"),s.a.ofType(De)))}};Object(r.a)([Object(b.b)({type:h.a,json:{write:{enabled:!0,isRequired:!0}}})],dt.prototype,"volumeId",void 0),Object(r.a)([Object(b.b)({type:Number,json:{default:1,write:!0}})],dt.prototype,"verticalExaggeration",void 0),Object(r.a)([Object(b.b)({type:["scale-position","scale-height"],json:{default:"scale-height",write:!0}})],dt.prototype,"exaggerationMode",void 0),Object(r.a)([Object(b.b)({type:Number,json:{default:0,write:!0}})],dt.prototype,"verticalOffset",void 0),Object(r.a)([Object(b.b)({type:s.a.ofType(Ke),json:{write:{enabled:!0,overridePolicy(){return{enabled:!!this.slices&&this.slices.length>0}}}}})],dt.prototype,"slices",null),Object(r.a)([Object(b.b)({type:s.a.ofType(De),json:{write:{enabled:!0,overridePolicy(){return{enabled:!!this.dynamicSections&&this.dynamicSections.length>0}}}}})],dt.prototype,"dynamicSections",null),dt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelVolumeStyle")],dt);const pt=dt;let jt=class extends ke.a{constructor(e){super(e),this.currentVariableId=0,this.renderMode="volume",this.enableSlices=!0,this.enableSections=!0,this.enableDynamicSections=!0,this.enableIsosurfaces=!0,this.shading=new $e,this.volumeStyles=new s.a,this.variableStyles=new s.a}set volumeStyles(e){this._set("volumeStyles",Object(Je.b)(e,this._get("volumeStyles"),s.a.ofType(pt)))}set variableStyles(e){this._set("variableStyles",Object(Je.b)(e,this._get("variableStyles"),s.a.ofType(ht)))}};Object(r.a)([Object(b.b)({type:s.a.ofType(pt),json:{write:!0}})],jt.prototype,"volumeStyles",null),Object(r.a)([Object(b.b)({type:h.a,json:{write:{enabled:!0,isRequired:!0}}})],jt.prototype,"currentVariableId",void 0),Object(r.a)([Object(b.b)({type:["volume","surfaces"],json:{write:!0}})],jt.prototype,"renderMode",void 0),Object(r.a)([Object(b.b)({type:s.a.ofType(ht),json:{write:!0}})],jt.prototype,"variableStyles",null),Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],jt.prototype,"enableSlices",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],jt.prototype,"enableSections",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],jt.prototype,"enableDynamicSections",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],jt.prototype,"enableIsosurfaces",void 0),Object(r.a)([Object(b.b)({type:$e,json:{write:!0}})],jt.prototype,"shading",void 0),jt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelStyle")],jt);const yt=jt;let mt=class extends ke.a{constructor(){super(...arguments),this.continuity=null,this.hasNoData=!1,this.noData=0,this.offset=0,this.scale=1,this.type=null}};Object(r.a)([Object(b.b)({type:["discrete","continuous"],json:{write:!0}})],mt.prototype,"continuity",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],mt.prototype,"hasNoData",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:!0}})],mt.prototype,"noData",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:!0}})],mt.prototype,"offset",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:!0}})],mt.prototype,"scale",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],mt.prototype,"type",void 0),mt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelFormat")],mt);const Ot=mt;let gt=class extends ke.a{constructor(){super(...arguments),this.id=null,this.description="",this.name=null,this.originalFormat=null,this.renderingFormat=null,this.unit="",this.volumeId=0,this.type=null}};Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],gt.prototype,"id",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],gt.prototype,"description",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],gt.prototype,"name",void 0),Object(r.a)([Object(b.b)({type:Ot,json:{write:!0}})],gt.prototype,"originalFormat",void 0),Object(r.a)([Object(b.b)({type:Ot,json:{write:{enabled:!0,isRequired:!0}}})],gt.prototype,"renderingFormat",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],gt.prototype,"unit",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:!0}})],gt.prototype,"volumeId",void 0),Object(r.a)([Object(b.b)({type:["stc-hot-spot-results","stc-cluster-outlier-results","stc-estimated-bin","generic-nearest-interpolated"],json:{write:!0}})],gt.prototype,"type",void 0),gt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelVariable")],gt);const ft=gt;let vt=class extends ke.a{constructor(){super(...arguments),this.values=null}};Object(r.a)([Object(b.b)({type:[Number],json:{write:!0}})],vt.prototype,"values",void 0),vt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelIrregularSpacing")],vt);const _t=vt;let wt=class extends ke.a{constructor(){super(...arguments),this.scale=1,this.offset=0}};Object(r.a)([Object(b.b)({type:Number,json:{write:!0}})],wt.prototype,"scale",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:!0}})],wt.prototype,"offset",void 0),wt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelRegularSpacing")],wt);const xt=wt;let St=class extends ke.a{constructor(){super(...arguments),this.irregularSpacing=null,this.isPositiveUp=null,this.isWrappedDateLine=null,this.label=null,this.name=null,this.quantity=null,this.regularSpacing=null,this.size=0,this.unit=null}};Object(r.a)([Object(b.b)({type:_t,json:{write:!0}})],St.prototype,"irregularSpacing",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],St.prototype,"isPositiveUp",void 0),Object(r.a)([Object(b.b)({type:Boolean,json:{write:!0}})],St.prototype,"isWrappedDateLine",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],St.prototype,"label",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],St.prototype,"name",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],St.prototype,"quantity",void 0),Object(r.a)([Object(b.b)({type:xt,json:{write:!0}})],St.prototype,"regularSpacing",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:!0}})],St.prototype,"size",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],St.prototype,"unit",void 0),St=Object(r.a)([Object(d.a)("esri.layers.support.VoxelDimension")],St);const Tt=St;let Vt=class extends ke.a{constructor(){super(...arguments),this.id=0,this.dimensions=null}getZDimension(){if(!this.dimensions)return-1;if(!Array.isArray(this.dimensions))return-1;if(4!==this.dimensions.length)return-1;for(let e=2;e<4;++e)if(this.dimensions[e].size>0)return e;return-1}isVolumeValid(){return!!this.dimensions&&!!Array.isArray(this.dimensions)&&4===this.dimensions.length&&!(this.dimensions[0].size<1||this.dimensions[1].size<1)&&-1!==this.getZDimension()}};Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],Vt.prototype,"id",void 0),Object(r.a)([Object(b.b)({type:[Tt],json:{write:{enabled:!0,isRequired:!0}}})],Vt.prototype,"dimensions",void 0),Vt=Object(r.a)([Object(d.a)("esri.layers.support.VoxelVolume")],Vt);const Rt=Vt;var It;let Pt=It=class extends ke.a{constructor(){super(...arguments),this.apronWidth=1,this.brickSize=[32,32,32],this.maxLodLevel=0,this.nodeSize=[4,4,4]}isValid(){const e=new It;return e.apronWidth===this.apronWidth&&e.maxLodLevel===this.maxLodLevel&&!!this.brickSize&&!!this.nodeSize&&!(!Array.isArray(this.brickSize)||!Array.isArray(this.nodeSize))&&3===this.brickSize.length&&3===this.nodeSize.length&&32===this.brickSize[0]&&32===this.brickSize[1]&&32===this.brickSize[2]&&4===this.nodeSize[0]&&4===this.nodeSize[1]&&4===this.nodeSize[2]}};Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],Pt.prototype,"apronWidth",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],Pt.prototype,"brickSize",void 0),Object(r.a)([Object(b.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],Pt.prototype,"maxLodLevel",void 0),Object(r.a)([Object(b.b)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],Pt.prototype,"nodeSize",void 0),Pt=It=Object(r.a)([Object(d.a)("esri.layers.support.VoxelVolumeIndex")],Pt);const At=Pt,Lt=o.a.getLogger(" esri.layers.VoxelLayer");let Mt=class extends(Object(ze.a)(Object(qe.a)(Object(Fe.a)(Object(Ce.a)(Object(We.a)(Object(c.a)(Object(Ee.a)(y.a)))))))){constructor(e){super(e),this.serviceRoot="",this.popupEnabled=!0,this.operationalLayerType="Voxel",this.legendEnabled=!0,this.title=null,this.url=null,this.sections=new s.a,this.style=null,this.opacity=1,this.variables=new s.a,this.volumes=new s.a,this.index=null,this.minScale=0,this.maxScale=0,this.type="voxel",this._dbgFlags=new Set,this._handles=new n.a,this._dbgFlags.add(3)}destroy(){this._handles=Object(a.d)(this._handles)}dbg(e,t){this._dbgFlags.has(e)&&(3===e?Lt.error(t):Lt.warn(t))}load(e){const t=Object(a.j)(e)?e.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(l.t).then(()=>this._fetchService(t)).then(()=>this.serviceRoot=this.url);return this.addResolvingPromise(i),Promise.resolve(this)}getConfiguration(){this._handles.add([Object(u.a)(()=>this._getRenderMode(),e=>this._pushRenderModeToWasm(e)),Object(u.a)(()=>this._getCurrentVariableId(),e=>this._pushCurrentVariableIdToWasm(e)),Object(u.a)(()=>this._getDynamicSections(),e=>this._pushDynamicSectionsToWasm(e)),Object(u.a)(()=>this._getSlices(),e=>this._pushSlicesToWasm(e)),Object(u.a)(()=>this._getSections(),e=>this._pushSectionsToWasm(e))]);const e={layerType:this.operationalLayerType,version:"3.0",name:this.title,spatialReference:this.spatialReference,fullExtent:this.fullExtent,volumes:this.volumes.toJSON(),variables:this.variables.toJSON(),index:this.index.toJSON(),sections:this.sections.toJSON(),style:this.style};return e.index&&this.index.isValid()?JSON.stringify(e):""}_getSections(){const e=[];for(const t of this.sections)e.push(new Xe({enabled:t.enabled,href:t.href,id:t.id,label:t.label,normal:t.normal,point:t.point,sizeInPixel:t.sizeInPixel,slices:t.slices,timeId:t.timeId,variableId:t.variableId}));return e}_pushSectionsToWasm(e){this.dbg(2,"VoxelLayer._pushSectionsToWasm() called"),Ne.getInstance().setLayerStaticSections(this,e)||this.dbg(3,"VoxelLayer._pushSectionsToWasm() failed!")}_isPlaneValid(e,t,i){if(!e.point)return!1;if(!Array.isArray(e.point)||3!==e.point.length)return!1;if(!e.normal)return!1;if(!Array.isArray(e.normal)||3!==e.normal.length)return!1;for(let s=0;s<3;++s){const r=e.point[s];if(r<0||r>=i[t[s]].size)return!1}const r=Object(j.g)(e.normal[0],e.normal[1],e.normal[2]);Object(p.o)(r,r);return!(Math.abs(r[0])+Math.abs(r[1])+Math.abs(r[2])<1e-6)&&(e.normal[0]=r[0],e.normal[1]=r[1],e.normal[2]=r[2],!0)}_getVariable(e){let t=-1;if(t=Object(a.j)(e)?e:this.style.currentVariableId,-1===t)return null;const i=this.variables.findIndex(e=>e.id===t);return i<0?null:this.variables.getItemAt(i)}_getVolume(e){const t=this._getVariable(e);return Object(a.j)(t)?this.volumes.find(({id:e})=>e===t.volumeId):null}_getVolumeStyle(e){const t=this._getVariable(e);return Object(a.j)(t)?this.style.volumeStyles.find(({volumeId:e})=>e===t.volumeId):null}_getSlices(){const e=[],t=this._getVolume(null);if(!Object(a.j)(t)||!t.isVolumeValid())return e;const i=this._getVolumeStyle(null);if(!Object(a.j)(i))return e;for(const r of i.slices)this._isPlaneValid(r,[0,1,t.getZDimension()],t.dimensions)?e.push(new Ke({enabled:r.enabled,label:r.label,point:r.point,normal:r.normal})):e.push(new Ke({enabled:!1,label:"invalid",point:r.point,normal:r.normal}));return e}_pushSlicesToWasm(e){this.dbg(2,"VoxelLayer._pushSlicesToWasm() called!"),Ne.getInstance().setLayerSlices(this,e)||this.dbg(3,"VoxelLayer._pushSlicesToWasm() failed!")}_getDynamicSections(){const e=[],t=this._getVolume(null);if(!Object(a.j)(t)||!t.isVolumeValid())return e;const i=this._getVolumeStyle(null);if(!Object(a.j)(i))return e;for(const r of i.dynamicSections)this._isPlaneValid(r,[0,1,t.getZDimension()],t.dimensions)?e.push(new De({enabled:r.enabled,label:r.label,point:r.point,normal:r.normal})):e.push(new De({enabled:!1,label:"invalid",point:r.point,normal:r.normal}));return e}_pushDynamicSectionsToWasm(e){this.dbg(2,"VoxelLayer._pushDynamicSectionsToWasm() called!"),Ne.getInstance().setLayerDynamicSections(this,e)||this.dbg(3,"VoxelLayer._updateDynamicSections() failed!")}_getCurrentVariableId(){return this.style?this.style.currentVariableId:-1}_pushCurrentVariableIdToWasm(e){this.dbg(2,"VoxelLayer._pushCurrentVariableIdToWasm() called!"),Ne.getInstance().setLayerCurrentVariable(this,e)||this.dbg(3,"VoxelLayer._pushCurrentVariableIdToWasm() failed!")}_getRenderMode(){return this.style?this.style.renderMode:"volume"}_pushRenderModeToWasm(e){this.dbg(2,"VoxelLayer._pushRenderModeToWasm() called!"),Ne.getInstance().setLayerRenderMode(this,e)||this.dbg(3,"VoxelLayer.setLayerRenderMode() failed!")}};Object(r.a)([Object(b.b)(Ue.j)],Mt.prototype,"popupEnabled",void 0),Object(r.a)([Object(b.b)({type:["Voxel"]})],Mt.prototype,"operationalLayerType",void 0),Object(r.a)([Object(b.b)(Ue.e)],Mt.prototype,"legendEnabled",void 0),Object(r.a)([Object(b.b)({json:{write:!0}})],Mt.prototype,"title",void 0),Object(r.a)([Object(b.b)({type:String,json:{write:!0}})],Mt.prototype,"url",void 0),Object(r.a)([Object(b.b)({type:s.a.ofType(Xe),json:{write:!0,origins:{"web-scene":{name:"layerDefinition.sections",write:!0},service:{write:!1}}}})],Mt.prototype,"sections",void 0),Object(r.a)([Object(b.b)({type:yt,json:{write:!0,origins:{"web-scene":{name:"layerDefinition.style",write:!0},service:{write:!1}}}})],Mt.prototype,"style",void 0),Object(r.a)([Object(b.b)({type:["show","hide"]})],Mt.prototype,"listMode",void 0),Object(r.a)([Object(b.b)({type:Number,range:{min:0,max:1},nonNullable:!0,json:{read:!1,write:!1,origins:{"web-scene":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Mt.prototype,"opacity",void 0),Object(r.a)([Object(b.b)({type:s.a.ofType(ft)})],Mt.prototype,"variables",void 0),Object(r.a)([Object(b.b)({type:s.a.ofType(Rt)})],Mt.prototype,"volumes",void 0),Object(r.a)([Object(b.b)({type:At})],Mt.prototype,"index",void 0),Object(r.a)([Object(b.b)({type:Number,json:{name:"layerDefinition.minScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],Mt.prototype,"minScale",void 0),Object(r.a)([Object(b.b)({type:Number,json:{name:"layerDefinition.maxScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],Mt.prototype,"maxScale",void 0),Object(r.a)([Object(b.b)({json:{read:!1},readOnly:!0})],Mt.prototype,"type",void 0),Mt=Object(r.a)([Object(d.a)("esri.layers.VoxelLayer")],Mt);const Nt=Mt},873:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return b}));var r=i(48),s=i(704),n=i(38),o=i(68),a=i(667);function c(e){return e?{origin:Object(o.c)(e.origin),vector:Object(o.c)(e.vector)}:{origin:Object(o.e)(),vector:Object(o.e)()}}function l(e,t,i=c()){return Object(n.h)(i.origin,e),Object(n.h)(i.vector,t),i}function u(e,t){const i=Object(n.g)(a.b.get(),t,e.origin),s=Object(n.e)(e.vector,i),o=Object(n.e)(e.vector,e.vector),c=Object(r.d)(s/o,0,1),l=Object(n.g)(a.b.get(),Object(n.b)(a.b.get(),e.vector,c),i);return Object(n.e)(l,l)}function b(e,t,i,s,o){const{vector:c,origin:l}=e,u=Object(n.g)(a.b.get(),t,l),b=Object(n.e)(c,u)/Object(n.p)(c);return Object(n.b)(o,c,Object(r.d)(b,i,s)),Object(n.c)(o,o,e.origin)}Object(o.e)(),Object(o.e)(),new s.a(()=>({origin:null,vector:null}))},874:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o}));var r=i(3),s=(i(77),i(602));i(672),i(714);function n(e,t){return Object(r.i)(e)&&(e=[]),e.push(t),e}function o(e,t){if(Object(r.i)(e))return null;const i=e.filter(e=>e!==t);return 0===i.length?null:i}function a(e){return!!Object(r.j)(e)&&!e.visible}new Float64Array(3),new Float32Array(6),Object(s.d)()}}]);
//# sourceMappingURL=49.bbc72759.chunk.js.map